<!DOCTYPE html>
<html>

<head>
    <title>Untitled</title>
</head>

<body>
    <canvas id="renderer"></canvas>
</body>

</html>
<script>
    (async function () {
        var sendKeypress = function () { }
        var kdcooldown = false;
        window.onkeydown = function (event) {
            event.preventDefault();
            if (kdcooldown) {
                return;
            }
            kdcooldown = true;
            sendKeypress({
                "key": event.key,
                "shiftKey": event.shiftKey,
                "ctrlKey": event.ctrlKey
            });
            kdcooldown = false;
        }
        var sendKeyRelease = function () { }
        var kucooldown = false;
        window.onkeyup = function (event) {
            if (kucooldown) {
                return;
            }
            sendKeyRelease({
                "key": event.key,
                "shiftKey": event.shiftKey,
                "ctrlKey": event.ctrlKey
            });
            kucooldown = false;
        }
        console.log("[Nodegames] Loading...");
        document.body.style.backgroundColor = "rgb(255, 255, 255)";
        document.body.style.margin = "0px";
        document.body.style.overflow = "hidden";

        var rendererelem = document.getElementById("renderer");
        rendererelem.width = window.innerWidth;
        rendererelem.height = window.innerHeight;
        rendererelem.style.position = "absolute";
        var oldWidth = window.innerWidth;
        var oldHeight = window.innerHeight;
        var sendSizeUpdate = function () { }
        setInterval(function () {
            if (oldWidth !== window.innerWidth || oldHeight !== window.innerHeight) {
                rendererelem.width = window.innerWidth;
                rendererelem.height = window.innerHeight;
                oldWidth = window.innerWidth;
                oldHeight = window.innerHeight;
                sendSizeUpdate();
            }
        }, 1);

        var sendMousePosUpdate = function () { }
        var mouseY = null;
        var mouseX = null;
        var pcooldown = false;
        var oldx = 0
        var oldy = 0
        var lastdirectionmousemove = null;
        rendererelem.onmousemove = function (event) {
            if (pcooldown) {
                return;
            }
            pcooldown = true;
            mouseX = event.clientX;
            mouseY = event.clientY;
            var direction = null
            var movementX = event.movementX
            var movementY = event.movementY
            if (movementX > 0) {
                if (movementY > 0) {
                    direction = "downright";
                }
                else {
                    if (movementY < 0) {
                        direction = "upright";
                    }
                    else {
                        direction = "right";
                    }
                }
            }
            else {
                if (movementX < 0) {
                    if (movementY > 0) {
                        direction = "downleft";
                    }
                    else {
                        if (movementY < 0) {
                            direction = "upleft";
                        }
                        else {
                            direction = "left";
                        }
                    }
                }
                else {
                    if (movementY > 0) {
                        direction = "down";
                    }
                    else {
                        if (movementY < 0) {
                            direction = "up";
                        }
                    }
                }
            }
            var speed = Math.sqrt(Math.pow(movementX, 2) + Math.pow(movementY, 2));
            sendMousePosUpdate({
                "x": event.clientX,
                "y": event.clientY,
                "direction": direction,
                "speed": parseInt(`${speed}`.split(".")[0]),
                "movement": {
                    "x": movementX,
                    "y": movementY
                }
            });
            oldx = event.pageX
            oldy = event.pageY
            if (!(direction === null)) {
                lastdirectionmousemove = direction;
            }
            pcooldown = false;
        }

        var sendMouseClick = function () { }
        rendererelem.onmousedown = function (event) {
            //If scrollwheel
            if (event.button === 1) {
                sendMouseClick({
                    "button": "scrollwheel",
                    "x": event.clientX,
                    "y": event.clientY
                });
            }
            else {
                //If left click
                if (event.button === 0) {
                    sendMouseClick({
                        "button": "left",
                        "x": event.clientX,
                        "y": event.clientY
                    });
                }
                else {
                    //If right click
                    if (event.button === 2) {
                        sendMouseClick({
                            "button": "right",
                            "x": event.clientX,
                            "y": event.clientY
                        });
                    }
                    else{
                        //Mouse side buttons
                        if(event.button === 3){
                            sendMouseClick({
                                "button": "side1",
                                "x": event.clientX,
                                "y": event.clientY
                            });
                        }
                        else{
                            if(event.button === 4){
                                sendMouseClick({
                                    "button": "side2",
                                    "x": event.clientX,
                                    "y": event.clientY
                                });
                            }
                        }
                    }
                }
            }
        }

        var sendMouseScroll = function () { }
        var wcooldown = false;
        rendererelem.onwheel = function (event) {
            if (wcooldown) {
                return;
            }
            wcooldown = true;
            var direction = null;
            var speed = null;
            //Can be left right down up choose the most significant
            if (event.deltaX > event.deltaY) {
                if (event.deltaX > 0) {
                    direction = "right";
                    speed = event.deltaX
                }
                else {
                    direction = "up";
                    speed = event.deltaY;
                }
            }
            else {
                if (event.deltaY > 0) {
                    direction = "down";
                    speed = event.deltaY;
                }
                else {
                    direction = "left";
                    speed = event.deltaX;
                }
            }
            //Invert speed
            speed = speed * -1;
            sendMouseScroll({
                "direction": direction,
                "speed": speed
            });
            wcooldown = false;
        }

        console.log("[Nodegames] Loaded.");
        console.log("[Nodegames] Waiting for connection info to load...");
        while (typeof port === "undefined") {
            await new Promise(function (resolve) { setTimeout(resolve, 1) });
        }
        console.log("[Nodegames] Connection info loaded.");
        //Create a websocket to 127.0.0.1:port
        var ws = new WebSocket("ws://127.0.0.1:" + port);
        console.log("[Nodegames] Connecting...");
        ws.onopen = async function () {
            var ws2 = new WebSocket("ws://127.0.0.1:" + port);
            var ws2opened = false
            ws2.onopen = function () {
                ws2opened = true
            }
            while (ws2opened === false) {
                await new Promise(function (resolve) { setTimeout(resolve, 1) });
            }
            var ctx = rendererelem.getContext("2d");
            var images = {};
            var sounds = {};
            console.log("[Nodegames] Connected and ready.")
            ws.onclose = function () {
                console.log("[Nodegames] Connection closed.")
                console.log("[Nodegames] Exiting...")
                window.close();
            }
            ws2.send(JSON.stringify({
                "type": "sizeupdate",
                "data": {
                    "width": rendererelem.width,
                    "height": rendererelem.height
                }
            }))
            sendSizeUpdate = function () {
                ws2.send(JSON.stringify({
                    "type": "sizeupdate",
                    "data": {
                        "width": rendererelem.width,
                        "height": rendererelem.height
                    }
                }))
            }
            sendMousePosUpdate = function (event) {
                ws2.send(JSON.stringify({
                    "type": "mouseposupdate",
                    "data": event
                }))
            }
            sendKeypress = function (key) {
                ws2.send(JSON.stringify({
                    "type": "keypress",
                    "data": key
                }))
            }
            sendMouseClick = function (data) {
                ws2.send(JSON.stringify({
                    "type": "mouseclick",
                    "data": data
                }))
            }
            sendMouseScroll = function (data) {
                ws2.send(JSON.stringify({
                    "type": "mousescroll",
                    "data": data
                }))
            }
            sendKeyRelease = function (key) {
                ws2.send(JSON.stringify({
                    "type": "keyrelease",
                    "data": key
                }))
            }
            //When pointers locks
            rendererelem.onpointerlockchange = function () {
                if (document.pointerLockElement === rendererelem) {
                    ws2.send(JSON.stringify({
                        "type": "pointerlock",
                        "data": {
                            "locked": true
                        }
                    }))
                }
                else {
                    ws2.send(JSON.stringify({
                        "type": "pointerlock",
                        "data": {
                            "locked": false
                        }
                    }))
                }
            }
            rendererelem.onpointerlockerror = function () {
                ws2.send(JSON.stringify({
                    "type": "pointerlockerror"
                }))
            }
            ws.onmessage = function (data) {
                data = data.data;
                data = JSON.parse(data);
                if (data.type === "setPixel") {
                    var rgb = data.data.rgb;
                    var x = data.data.x;
                    var y = data.data.y;
                    ctx.fillStyle = rgb.toString();
                    ctx.fillRect(x, y, 1, 1);
                }
                else {
                    if (data.type === "clear") {
                        ctx.clearRect(0, 0, rendererelem.width, rendererelem.height);
                    }
                    else {
                        if (data.type === "setRectangle") {
                            //If there is a rotation propertie its in degrees the rotation point is the center of the shape
                            //If outline propertie is true only draw the outline else fill the shape
                            var x = data.data.x;
                            var y = data.data.y;
                            var width = data.data.width;
                            var height = data.data.height;
                            var rgb = data.data.rgb;
                            var rotation = data.data.rotation;
                            var outline = data.data.outline;
                            ctx.fillStyle = rgb.toString();
                            if (!(rotation === 0)) {
                                ctx.save();
                                ctx.translate(x + width / 2, y + height / 2);
                                ctx.rotate(Math.PI / 180 * rotation);
                                ctx.translate(-(x + width / 2), -(y + height / 2));
                                if (outline) {
                                    ctx.strokeStyle = rgb.toString();
                                    ctx.strokeRect(x, y, width, height);
                                }
                                else {
                                    ctx.fillRect(x, y, width, height);
                                }
                                ctx.restore();
                            }
                            else {
                                if (outline) {
                                    ctx.strokeStyle = rgb.toString();
                                    ctx.strokeRect(x, y, width, height);
                                }
                                else {
                                    ctx.fillRect(x, y, width, height);
                                }
                            }
                        }
                        else {
                            if (data.type === "setCircle") {
                                //If there is a rotation propertie its in degrees the rotation point is the center of the shape
                                //If outline propertie is true only draw the outline else fill the shape
                                var x = data.data.x;
                                var y = data.data.y;
                                var radius = data.data.radius;
                                var rgb = data.data.rgb;
                                var rotation = data.data.rotation;
                                var outline = data.data.outline;
                                ctx.fillStyle = rgb.toString();
                                if (!(rotation === 0)) {
                                    ctx.save();
                                    ctx.translate(x + radius, y + radius);
                                    ctx.rotate(Math.PI / 180 * rotation);
                                    ctx.translate(-(x + radius), -(y + radius));
                                    if (outline) {
                                        ctx.strokeStyle = rgb.toString();
                                        ctx.beginPath();
                                        ctx.arc(x, y, radius, 0, 2 * Math.PI);
                                        ctx.stroke();
                                    }
                                    else {
                                        ctx.beginPath();
                                        ctx.arc(x, y, radius, 0, 2 * Math.PI);
                                        ctx.fill();
                                    }
                                    ctx.restore();
                                }
                                else {
                                    if (outline) {
                                        ctx.strokeStyle = rgb.toString();
                                        ctx.beginPath();
                                        ctx.arc(x, y, radius, 0, 2 * Math.PI);
                                        ctx.stroke();
                                    }
                                    else {
                                        ctx.beginPath();
                                        ctx.arc(x, y, radius, 0, 2 * Math.PI);
                                        ctx.fill();
                                    }
                                }
                            }
                            else {
                                if (data.type === "setLine") {
                                    //If there is a rotation propertie its in degrees the rotation point is the center of the shape
                                    var x1 = data.data.x1;
                                    var y1 = data.data.y1;
                                    var x2 = data.data.x2;
                                    var y2 = data.data.y2;
                                    var rgb = data.data.rgb;
                                    var rotation = data.data.rotation;
                                    ctx.strokeStyle = rgb.toString();
                                    if (!(rotation === 0)) {
                                        ctx.save();
                                        ctx.translate(x1 + (x2 - x1) / 2, y1 + (y2 - y1) / 2);
                                        ctx.rotate(Math.PI / 180 * rotation);
                                        ctx.translate(-(x1 + (x2 - x1) / 2), -(y1 + (y2 - y1) / 2));
                                        ctx.beginPath();
                                        ctx.moveTo(x1, y1);
                                        ctx.lineTo(x2, y2);
                                        ctx.stroke();
                                        ctx.restore();
                                    }
                                    else {
                                        ctx.beginPath();
                                        ctx.moveTo(x1, y1);
                                        ctx.lineTo(x2, y2);
                                        ctx.stroke();
                                    }
                                }
                                else {
                                    if (data.type === "setText") {
                                        //FontSize and fontName propertie are text style
                                        //If there is a rotation propertie its in degrees the rotation point is the center of the shape
                                        //If outline propertie is true only draw the outline else fill the shape
                                        var x = data.data.x;
                                        var y = data.data.y;
                                        var text = data.data.text;
                                        var rgb = data.data.rgb;
                                        var fontSize = data.data.fontSize;
                                        var fontName = data.data.fontName;
                                        var rotation = data.data.rotation;
                                        var outline = data.data.outline;
                                        ctx.fillStyle = rgb.toString();
                                        ctx.font = fontSize + "px " + fontName;
                                        if (!(rotation === 0)) {
                                            ctx.save();
                                            ctx.translate(x + ctx.measureText(text).width / 2, y + fontSize / 2);
                                            ctx.rotate(Math.PI / 180 * rotation);
                                            ctx.translate(-(x + ctx.measureText(text).width / 2), -(y + fontSize / 2));
                                            if (outline) {
                                                ctx.strokeStyle = rgb.toString();
                                                ctx.strokeText(text, x, y);
                                            }
                                            else {
                                                ctx.fillText(text, x, y);
                                            }
                                            ctx.restore();
                                        }
                                        else {
                                            if (outline) {
                                                ctx.strokeStyle = rgb.toString();
                                                ctx.strokeText(text, x, y);
                                            }
                                            else {
                                                ctx.fillText(text, x, y);
                                            }
                                        }
                                    }
                                    else {
                                        if (data.type === "rawctx") {
                                            eval(data.data.rawctx)
                                        }
                                        else {
                                            if (data.type === "clearZone") {
                                                var x = data.data.x;
                                                var y = data.data.y;
                                                var width = data.data.width;
                                                var height = data.data.height;
                                                var rotation = data.data.rotation

                                                ctx.save()
                                                if (!(rotation === 0)) {
                                                    ctx.translate(x + width / 2, y + height / 2);
                                                    ctx.rotate(Math.PI / 180 * rotation);
                                                    ctx.translate(-(x + width / 2), -(y + height / 2));
                                                    ctx.clearRect(x, y, width, height);
                                                }
                                                else {
                                                    ctx.clearRect(x, y, width, height);
                                                }
                                                ctx.restore()
                                            }
                                            else {
                                                if (data.type === "setPixelArray") {
                                                    var pixelArray = data.data.pixelArray;
                                                    var index = 0;
                                                    while (index < pixelArray.length) {
                                                        var rgb = pixelArray[index][0];
                                                        var x = pixelArray[index][1];
                                                        var y = pixelArray[index][2];
                                                        ctx.fillStyle = rgb.toString();
                                                        ctx.fillRect(x, y, 1, 1);
                                                        index += 1;
                                                    }
                                                }
                                                else {
                                                    if (data.type === "multipleInstructions") {
                                                        var instructions = data.data.instructions;
                                                        instructions = "[" + instructions + "]";
                                                        instructions = JSON.parse(instructions);
                                                        var i = 0;
                                                        while (i < instructions.length) {
                                                            var item = instructions[i];
                                                            ws.onmessage({ "data": JSON.stringify(item) });
                                                            i += 1;
                                                        }
                                                        ws2.send(JSON.stringify({
                                                            "type": "framerendered"
                                                        }))
                                                    }
                                                    else {
                                                        if (data.type === "action") {
                                                            if (data.data.action === "close") {
                                                                ws.close()
                                                                window.close();
                                                            }
                                                        }
                                                        else {
                                                            if (data.type === "loadImage") {
                                                                var id = data.data.id;
                                                                var base64 = data.data.base64;
                                                                var b64toBlob = function (b64Data, contentType = "", sliceSize = 512) {
                                                                    var byteCharacters;
                                                                    try {
                                                                        byteCharacters = atob(b64Data);
                                                                    }
                                                                    catch (error) {
                                                                        ws2.send(JSON.stringify({
                                                                            "type": "errorLoadingImage",
                                                                            "data": {
                                                                                "id": id
                                                                            }
                                                                        }))
                                                                        return;
                                                                    }
                                                                    var byteArrays = [];

                                                                    var offset = 0;
                                                                    while (offset < byteCharacters.length) {
                                                                        const slice = byteCharacters.slice(offset, offset + sliceSize);

                                                                        const byteNumbers = new Array(slice.length);
                                                                        var i = 0;
                                                                        while (i < slice.length) {
                                                                            byteNumbers[i] = slice.charCodeAt(i);
                                                                            i += 1;
                                                                        }

                                                                        var byteArray = new Uint8Array(byteNumbers);
                                                                        byteArrays.push(byteArray);
                                                                        offset += sliceSize
                                                                    }

                                                                    const blob = new Blob(byteArrays, { type: contentType });
                                                                    return blob;
                                                                }
                                                                var blob;
                                                                try {
                                                                    blob = b64toBlob(base64, "image/png");
                                                                }
                                                                catch (error) {
                                                                    //Try jpeg
                                                                    try {
                                                                        blob = b64toBlob(base64, "image/jpeg");
                                                                    }
                                                                    catch (error) {
                                                                        ws2.send(JSON.stringify({
                                                                            "type": "errorLoadingImage",
                                                                            "data": {
                                                                                "id": id
                                                                            }
                                                                        }))
                                                                        return;
                                                                    }
                                                                }
                                                                var url;
                                                                try {
                                                                    url = URL.createObjectURL(blob);
                                                                }
                                                                catch (error) {
                                                                    ws2.send(JSON.stringify({
                                                                        "type": "errorLoadingImage",
                                                                        "data": {
                                                                            "id": id
                                                                        }
                                                                    }))
                                                                    return;
                                                                }
                                                                var img = new Image();
                                                                img.onload = function () {
                                                                    images[id] = img;
                                                                    ws2.send(JSON.stringify({
                                                                        "type": "imageLoaded",
                                                                        "data": {
                                                                            "id": id
                                                                        }
                                                                    }))
                                                                }
                                                                img.src = url;
                                                            }
                                                            else {
                                                                if (data.type === "setImage") {
                                                                    var id = data.data.id;
                                                                    var width = data.data.width;
                                                                    var height = data.data.height;
                                                                    var x = data.data.x;
                                                                    var y = data.data.y;
                                                                    var rotation = data.data.rotation;
                                                                    if (rotation == null) {
                                                                        rotation = 0;
                                                                    }
                                                                    var image = images[id];
                                                                    //Draw the image
                                                                    if (!(rotation === 0)) {
                                                                        ctx.save();
                                                                        ctx.translate(x + width / 2, y + height / 2);
                                                                        ctx.rotate(Math.PI / 180 * rotation);
                                                                        ctx.translate(-(x + width / 2), -(y + height / 2));
                                                                        try {
                                                                            ctx.drawImage(image, x, y, width, height);
                                                                        }
                                                                        catch (error) {
                                                                            ctx.restore();
                                                                            ws2.send(JSON.stringify({
                                                                                "type": "errorDrawingImage",
                                                                                "data": {
                                                                                    "id": id
                                                                                }
                                                                            }))
                                                                            return;
                                                                        }
                                                                        ctx.restore();
                                                                    }
                                                                    else {
                                                                        try {
                                                                            ctx.drawImage(image, x, y, width, height);
                                                                        }
                                                                        catch (error) {
                                                                            ws2.send(JSON.stringify({
                                                                                "type": "errorDrawingImage",
                                                                                "data": {
                                                                                    "id": id
                                                                                }
                                                                            }))
                                                                            return;
                                                                        }
                                                                    }
                                                                }
                                                                else {
                                                                    if (data.type === "unloadImage") {
                                                                        var id = data.data.id;
                                                                        //if image doesnt exist
                                                                        if (images[id] == null) {
                                                                            ws2.send(JSON.stringify({
                                                                                "type": "errorUnloadingImage",
                                                                                "data": {
                                                                                    "id": id
                                                                                }
                                                                            }))
                                                                            return;
                                                                        }
                                                                        delete images[id];
                                                                        ws2.send(JSON.stringify({
                                                                            "type": "imageUnloaded",
                                                                            "data": {
                                                                                "id": id
                                                                            }
                                                                        }))
                                                                    }
                                                                    else {
                                                                        if (data.type === "setTitle") {
                                                                            document.title = data.data.title
                                                                        }
                                                                        else {
                                                                            if (data.type === "loadSound") {
                                                                                var id = data.data.id
                                                                                var base64 = data.data.base64
                                                                                var b64toBlob = function (b64Data, contentType = "", sliceSize = 512) {
                                                                                    var byteCharacters;
                                                                                    try {
                                                                                        byteCharacters = atob(b64Data);
                                                                                    }
                                                                                    catch (error) {
                                                                                        ws2.send(JSON.stringify({
                                                                                            "type": "errorLoadingSound",
                                                                                            "data": {
                                                                                                "id": id
                                                                                            }
                                                                                        }))
                                                                                        return;
                                                                                    }
                                                                                    var byteArrays = [];

                                                                                    var offset = 0;
                                                                                    while (offset < byteCharacters.length) {
                                                                                        const slice = byteCharacters.slice(offset, offset + sliceSize);

                                                                                        const byteNumbers = new Array(slice.length);
                                                                                        var i = 0;
                                                                                        while (i < slice.length) {
                                                                                            byteNumbers[i] = slice.charCodeAt(i);
                                                                                            i += 1;
                                                                                        }

                                                                                        var byteArray = new Uint8Array(byteNumbers);
                                                                                        byteArrays.push(byteArray);
                                                                                        offset += sliceSize
                                                                                    }

                                                                                    const blob = new Blob(byteArrays, { type: contentType });
                                                                                    return blob;
                                                                                }
                                                                                var blob;
                                                                                //mp3
                                                                                try {
                                                                                    blob = b64toBlob(base64, "audio/mpeg");
                                                                                }
                                                                                catch (error) {
                                                                                    //wav
                                                                                    try {
                                                                                        blob = b64toBlob(base64, "audio/wav");
                                                                                    }
                                                                                    catch (error) {
                                                                                        ws2.send(JSON.stringify({
                                                                                            "type": "errorLoadingSound",
                                                                                            "data": {
                                                                                                "id": id
                                                                                            }
                                                                                        }))
                                                                                        return;
                                                                                    }
                                                                                }
                                                                                var url;
                                                                                try {
                                                                                    url = URL.createObjectURL(blob);
                                                                                }
                                                                                catch (error) {
                                                                                    ws2.send(JSON.stringify({
                                                                                        "type": "errorLoadingSound",
                                                                                        "data": {
                                                                                            "id": id
                                                                                        }
                                                                                    }))
                                                                                    return;
                                                                                }
                                                                                var audio = new Audio();
                                                                                audio.oncanplaythrough = function () {
                                                                                    sounds[id] = audio;
                                                                                    ws2.send(JSON.stringify({
                                                                                        "type": "soundLoaded",
                                                                                        "data": {
                                                                                            "id": id
                                                                                        }
                                                                                    }))
                                                                                }
                                                                                audio.src = url;
                                                                            }
                                                                            else {
                                                                                if (data.type === "playSound") {
                                                                                    var id = data.data.id
                                                                                    var loop = data.data.loop
                                                                                    //If sound doesnt exist
                                                                                    if (sounds[id] == null) {
                                                                                        ws2.send(JSON.stringify({
                                                                                            "type": "errorPlayingSound",
                                                                                            "data": {
                                                                                                "id": id
                                                                                            }
                                                                                        }))
                                                                                        return;
                                                                                    }
                                                                                    //If loop is true loop the sound else play it once
                                                                                    var sound = sounds[id]
                                                                                    if (loop) {
                                                                                        sound.loop = true
                                                                                        sound.play()
                                                                                    }
                                                                                    else {
                                                                                        sound.loop = false
                                                                                        sound.play()
                                                                                    }
                                                                                }
                                                                                else {
                                                                                    if (data.type === "unloadSound") {
                                                                                        var id = data.data.id
                                                                                        //if sound doesnt exist
                                                                                        if (sounds[id] == null) {
                                                                                            ws2.send(JSON.stringify({
                                                                                                "type": "errorUnloadingSound",
                                                                                                "data": {
                                                                                                    "id": id
                                                                                                }
                                                                                            }))
                                                                                            return;
                                                                                        }
                                                                                        //Stop sound from playing
                                                                                        sounds[id].pause()
                                                                                        delete sounds[id]
                                                                                        ws2.send(JSON.stringify({
                                                                                            "type": "soundUnloaded",
                                                                                            "data": {
                                                                                                "id": id
                                                                                            }
                                                                                        }))
                                                                                    }
                                                                                    else {
                                                                                        if (data.type === "stopSound") {
                                                                                            var id = data.data.id
                                                                                            //If sound doesnt exist
                                                                                            if (sounds[id] == null) {
                                                                                                ws2.send(JSON.stringify({
                                                                                                    "type": "errorStoppingSound",
                                                                                                    "data": {
                                                                                                        "id": id
                                                                                                    }
                                                                                                }))
                                                                                                return;
                                                                                            }
                                                                                            //Stop sound from playing
                                                                                            sounds[id].pause()
                                                                                            sounds[id].currentTime = 0
                                                                                            ws2.send(JSON.stringify({
                                                                                                "type": "soundStopped",
                                                                                                "data": {
                                                                                                    "id": id
                                                                                                }
                                                                                            }))
                                                                                        }
                                                                                        else {
                                                                                            if (data.type === "pointer") {
                                                                                                if (data.data.action === "lock") {
                                                                                                    rendererelem.requestPointerLock()
                                                                                                }
                                                                                                else {
                                                                                                    if (data.data.action === "unlock") {
                                                                                                        document.exitPointerLock()
                                                                                                    }
                                                                                                    else {
                                                                                                        if (data.data.action === "hide") {
                                                                                                            //Hide without locking
                                                                                                            rendererelem.style.cursor = "none"
                                                                                                        }
                                                                                                        else {
                                                                                                            if (data.data.action === "show") {
                                                                                                                //Show without unlocking
                                                                                                                rendererelem.style.cursor = "default"
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                            else {
                                                                                                if (data.type === "devtools") {
                                                                                                    if (data.data.action === "enable") {
                                                                                                        window.onkeydown = function (event) {
                                                                                                            //event.preventDefault();
                                                                                                            //Instead of cancelling check if trying to open dev tools if yes dont cancel else cancel
                                                                                                            //Control shift i
                                                                                                            var no = false;
                                                                                                            if (event.ctrlKey && event.shiftKey && event.key === "I") {
                                                                                                                no = true;
                                                                                                            }
                                                                                                            //Control shift j
                                                                                                            if (event.ctrlKey && event.shiftKey && event.key === "J") {
                                                                                                                no = true;
                                                                                                            }
                                                                                                            //Control shift c
                                                                                                            if (event.ctrlKey && event.shiftKey && event.key === "C") {
                                                                                                                no = true;
                                                                                                            }
                                                                                                            //F12
                                                                                                            if (event.key === "F12") {
                                                                                                                no = true;
                                                                                                            }
                                                                                                            //CMD option i
                                                                                                            if (event.metaKey && event.altKey && event.key === "I") {
                                                                                                                no = true;
                                                                                                            }
                                                                                                            //CMD option j
                                                                                                            if (event.metaKey && event.altKey && event.key === "J") {
                                                                                                                no = true;
                                                                                                            }
                                                                                                            //CMD option c
                                                                                                            if (event.metaKey && event.altKey && event.key === "C") {
                                                                                                                no = true;
                                                                                                            }
                                                                                                            if (no === false) {
                                                                                                                event.preventDefault();
                                                                                                            }
                                                                                                            no = null;
                                                                                                            if (kdcooldown) {
                                                                                                                return;
                                                                                                            }
                                                                                                            kdcooldown = true;
                                                                                                            sendKeypress({
                                                                                                                "key": event.key,
                                                                                                                "shiftKey": event.shiftKey,
                                                                                                                "ctrlKey": event.ctrlKey
                                                                                                            });
                                                                                                            kdcooldown = false;
                                                                                                        }
                                                                                                    }
                                                                                                    else {
                                                                                                        if (data.data.action === "disable") {
                                                                                                            window.onkeydown = function (event) {
                                                                                                                event.preventDefault();
                                                                                                                if (kdcooldown) {
                                                                                                                    return;
                                                                                                                }
                                                                                                                kdcooldown = true;
                                                                                                                sendKeypress({
                                                                                                                    "key": event.key,
                                                                                                                    "shiftKey": event.shiftKey,
                                                                                                                    "ctrlKey": event.ctrlKey
                                                                                                                });
                                                                                                                kdcooldown = false;
                                                                                                            }
                                                                                                        }
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    })()
</script>